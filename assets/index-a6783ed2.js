(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(r){if(r.ep)return;r.ep=!0;const l=n(r);fetch(r.href,l)}})();class ne{constructor(t,n,i){this._gl=t,this._program=this._gl.createProgram(),this._program||console.error("failed to creat a program.");const r=this.compileShader(this._gl.VERTEX_SHADER,n),l=this.compileShader(this._gl.FRAGMENT_SHADER,i);this._gl.attachShader(this._program,r),this._gl.attachShader(this._program,l),this._gl.linkProgram(this._program),t.getProgramParameter(this._program,t.LINK_STATUS)||console.error(t.getProgramInfoLog(this._program))}use(){this._gl.useProgram(this._program)}get id(){return this._program}compileShader(t,n){const i=this._gl.createShader(t);if(!i)return console.error(`failed to creat a shader type ${t}.`);if(this._gl.shaderSource(i,n),this._gl.compileShader(i),this._gl.getShaderParameter(i,this._gl.COMPILE_STATUS))return i;console.log(this._gl.getShaderInfoLog(i))}}class le{constructor(t,n){this._canvas=document.getElementById("canvas"),this._canvas.width=t,this._canvas.height=n,this._gl=this._canvas.getContext("webgl2"),this._gl&&(this._gl.viewport(0,0,t,n),this._gl.enable(this._gl.DEPTH_TEST),this._gl.cullFace(this._gl.BACK),this._gl.enable(this._gl.CULL_FACE))}clear(){this._gl&&(this._gl.clearColor(0,0,0,1),this._gl.clear(this._gl.DEPTH_BUFFER_BIT|this._gl.COLOR_BUFFER_BIT))}get gl(){return this._gl}}class se{constructor(t){this._gl=t,this._VAO=null,this._IBO=null,this._VBO=null,this._indexCount=0,this._vertices=[],this._indices=[]}initialise(){this._indexCount=this._indices.length;const t=[];for(let n=0;n<this._vertices.length;n++){const{position:i,normal:r,texCoord:l}=this._vertices[n];t.push(...i,...r,...l)}this._VAO=this._gl.createVertexArray(),this._gl.bindVertexArray(this._VAO),this._IBO=this._gl.createBuffer(),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this._IBO),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(this._indices),this._gl.STATIC_DRAW),this._VBO=this._gl.createBuffer(),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._VBO),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(t),this._gl.STATIC_DRAW),this._gl.vertexAttribPointer(0,3,this._gl.FLOAT,!1,4*8,0),this._gl.enableVertexAttribArray(0),this._gl.vertexAttribPointer(1,3,this._gl.FLOAT,!1,4*8,4*3),this._gl.enableVertexAttribArray(1),this._gl.vertexAttribPointer(2,2,this._gl.FLOAT,!1,4*8,4*6),this._gl.enableVertexAttribArray(2),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,null),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,null),this._gl.bindVertexArray(null)}draw(){this._gl.bindVertexArray(this._VAO),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,this._IBO),this._gl.drawElements(this._gl.TRIANGLES,this._indexCount,this._gl.UNSIGNED_SHORT,0),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,null),this._gl.bindVertexArray(null)}}const C=1e-6;let m=typeof Float32Array<"u"?Float32Array:Array;const ce=Math.PI/180;function q(e){return e*ce}function he(){let e=new m(9);return m!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function F(){let e=new m(16);return m!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function _e(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function j(e,t,n,i){let r=i[0],l=i[1],s=i[2],c=Math.sqrt(r*r+l*l+s*s),h,a,_,f,g,o,T,d,E,x,R,y,v,M,b,I,U,P,S,B,L,D,O,w;return c<C?null:(c=1/c,r*=c,l*=c,s*=c,h=Math.sin(n),a=Math.cos(n),_=1-a,f=t[0],g=t[1],o=t[2],T=t[3],d=t[4],E=t[5],x=t[6],R=t[7],y=t[8],v=t[9],M=t[10],b=t[11],I=r*r*_+a,U=l*r*_+s*h,P=s*r*_-l*h,S=r*l*_-s*h,B=l*l*_+a,L=s*l*_+r*h,D=r*s*_+l*h,O=l*s*_-r*h,w=s*s*_+a,e[0]=f*I+d*U+y*P,e[1]=g*I+E*U+v*P,e[2]=o*I+x*U+M*P,e[3]=T*I+R*U+b*P,e[4]=f*S+d*B+y*L,e[5]=g*S+E*B+v*L,e[6]=o*S+x*B+M*L,e[7]=T*S+R*B+b*L,e[8]=f*D+d*O+y*w,e[9]=g*D+E*O+v*w,e[10]=o*D+x*O+M*w,e[11]=T*D+R*O+b*w,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function ae(e,t,n){let i=Math.sin(n),r=Math.cos(n),l=t[0],s=t[1],c=t[2],h=t[3],a=t[8],_=t[9],f=t[10],g=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=l*r-a*i,e[1]=s*r-_*i,e[2]=c*r-f*i,e[3]=h*r-g*i,e[8]=l*i+a*r,e[9]=s*i+_*r,e[10]=c*i+f*r,e[11]=h*i+g*r,e}function oe(e,t,n){let i=Math.sin(n),r=Math.cos(n),l=t[0],s=t[1],c=t[2],h=t[3],a=t[4],_=t[5],f=t[6],g=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=l*r+a*i,e[1]=s*r+_*i,e[2]=c*r+f*i,e[3]=h*r+g*i,e[4]=a*r-l*i,e[5]=_*r-s*i,e[6]=f*r-c*i,e[7]=g*r-h*i,e}function ge(e,t,n,i,r){const l=1/Math.tan(t/2);if(e[0]=l/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==1/0){const s=1/(i-r);e[10]=(r+i)*s,e[14]=2*r*i*s}else e[10]=-1,e[14]=-2*i;return e}const fe=ge;function de(e,t,n,i){let r,l,s,c,h,a,_,f,g,o,T=t[0],d=t[1],E=t[2],x=i[0],R=i[1],y=i[2],v=n[0],M=n[1],b=n[2];return Math.abs(T-v)<C&&Math.abs(d-M)<C&&Math.abs(E-b)<C?_e(e):(_=T-v,f=d-M,g=E-b,o=1/Math.sqrt(_*_+f*f+g*g),_*=o,f*=o,g*=o,r=R*g-y*f,l=y*_-x*g,s=x*f-R*_,o=Math.sqrt(r*r+l*l+s*s),o?(o=1/o,r*=o,l*=o,s*=o):(r=0,l=0,s=0),c=f*s-g*l,h=g*r-_*s,a=_*l-f*r,o=Math.sqrt(c*c+h*h+a*a),o?(o=1/o,c*=o,h*=o,a*=o):(c=0,h=0,a=0),e[0]=r,e[1]=c,e[2]=_,e[3]=0,e[4]=l,e[5]=h,e[6]=f,e[7]=0,e[8]=s,e[9]=a,e[10]=g,e[11]=0,e[12]=-(r*T+l*d+s*E),e[13]=-(c*T+h*d+a*E),e[14]=-(_*T+f*d+g*E),e[15]=1,e)}function N(){let e=new m(3);return m!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Ee(e){let t=e[0],n=e[1],i=e[2];return Math.sqrt(t*t+n*n+i*i)}function u(e,t,n){let i=new m(3);return i[0]=e,i[1]=t,i[2]=n,i}function Z(e,t){let n=t[0],i=t[1],r=t[2],l=n*n+i*i+r*r;return l>0&&(l=1/Math.sqrt(l)),e[0]=t[0]*l,e[1]=t[1]*l,e[2]=t[2]*l,e}function Te(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function G(e,t,n){let i=t[0],r=t[1],l=t[2],s=n[0],c=n[1],h=n[2];return e[0]=r*h-l*c,e[1]=l*s-i*h,e[2]=i*c-r*s,e}function W(e,t,n){let i=t[0],r=t[1],l=t[2],s=n[3]*i+n[7]*r+n[11]*l+n[15];return s=s||1,e[0]=(n[0]*i+n[4]*r+n[8]*l+n[12])/s,e[1]=(n[1]*i+n[5]*r+n[9]*l+n[13])/s,e[2]=(n[2]*i+n[6]*r+n[10]*l+n[14])/s,e}const me=Ee;(function(){let e=N();return function(t,n,i,r,l,s){let c,h;for(n||(n=3),i||(i=0),r?h=Math.min(r*n+i,t.length):h=t.length,c=i;c<h;c+=n)e[0]=t[c],e[1]=t[c+1],e[2]=t[c+2],l(e,e,s),t[c]=e[0],t[c+1]=e[1],t[c+2]=e[2];return t}})();function Ae(){let e=new m(4);return m!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function pe(e,t){let n=t[0],i=t[1],r=t[2],l=t[3],s=n*n+i*i+r*r+l*l;return s>0&&(s=1/Math.sqrt(s)),e[0]=n*s,e[1]=i*s,e[2]=r*s,e[3]=l*s,e}(function(){let e=Ae();return function(t,n,i,r,l,s){let c,h;for(n||(n=4),i||(i=0),r?h=Math.min(r*n+i,t.length):h=t.length,c=i;c<h;c+=n)e[0]=t[c],e[1]=t[c+1],e[2]=t[c+2],e[3]=t[c+3],l(e,e,s),t[c]=e[0],t[c+1]=e[1],t[c+2]=e[2],t[c+3]=e[3];return t}})();function K(){let e=new m(4);return m!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function ue(e,t,n){n=n*.5;let i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e}function Y(e,t,n,i){let r=t[0],l=t[1],s=t[2],c=t[3],h=n[0],a=n[1],_=n[2],f=n[3],g,o,T,d,E;return o=r*h+l*a+s*_+c*f,o<0&&(o=-o,h=-h,a=-a,_=-_,f=-f),1-o>C?(g=Math.acos(o),T=Math.sin(g),d=Math.sin((1-i)*g)/T,E=Math.sin(i*g)/T):(d=1-i,E=i),e[0]=d*r+E*h,e[1]=d*l+E*a,e[2]=d*s+E*_,e[3]=d*c+E*f,e}function xe(e,t){let n=t[0]+t[4]+t[8],i;if(n>0)i=Math.sqrt(n+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[r*3+r]&&(r=2);let l=(r+1)%3,s=(r+2)%3;i=Math.sqrt(t[r*3+r]-t[l*3+l]-t[s*3+s]+1),e[r]=.5*i,i=.5/i,e[3]=(t[l*3+s]-t[s*3+l])*i,e[l]=(t[l*3+r]+t[r*3+l])*i,e[s]=(t[s*3+r]+t[r*3+s])*i}return e}const J=pe;(function(){let e=N(),t=u(1,0,0),n=u(0,1,0);return function(i,r,l){let s=Te(r,l);return s<-.999999?(G(e,t,r),me(e)<1e-6&&G(e,n,r),Z(e,e),ue(i,e,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(G(e,r,l),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+s,J(i,i))}})();(function(){let e=K(),t=K();return function(n,i,r,l,s,c){return Y(e,i,s,c),Y(t,r,l,c),Y(n,e,t,2*c*(1-c)),n}})();(function(){let e=he();return function(t,n,i,r){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],J(t,xe(t,e))}})();function Re(){let e=new m(2);return m!=Float32Array&&(e[0]=0,e[1]=0),e}function ye(e,t){let n=new m(2);return n[0]=e,n[1]=t,n}(function(){let e=Re();return function(t,n,i,r,l,s){let c,h;for(n||(n=2),i||(i=0),r?h=Math.min(r*n+i,t.length):h=t.length,c=i;c<h;c+=n)e[0]=t[c],e[1]=t[c+1],l(e,e,s),t[c]=e[0],t[c+1]=e[1];return t}})();class ve extends se{constructor(t,n){super(t);const i=20,r=20,l=-2*Math.PI/i,s=-1*Math.PI/r;for(let c=0;c<=r;c++){const h=F();j(h,F(),s*c,u(0,0,1));const a=N();W(a,u(0,-n,0),h);for(let _=0;_<=i;_++){const f=F();j(f,F(),l*_,u(0,1,0));const g=N();W(g,a,f);const o=N();Z(o,g);const T=ye(1-_/i,1-c/r);this._vertices.push({position:g,normal:o,texCoord:T})}}for(let c=0;c<r;c++){const h=(i+1)*c;for(let a=0;a<i;a++)this._indices.push(h+a),this._indices.push(h+a+i+1),this._indices.push(h+a+1+i+1),this._indices.push(h+a),this._indices.push(h+a+1+i+1),this._indices.push(h+a+1)}}}class Me{constructor(t){this._gl=t,this._textureID=t.createTexture()}initialise(t){this._gl.bindTexture(this._gl.TEXTURE_2D,this._textureID),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGB,this._gl.RGB,this._gl.UNSIGNED_BYTE,t),this._gl.bindTexture(this._gl.TEXTURE_2D,null)}use(){this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._textureID)}update(t){this.use(),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGB,this._gl.RGB,this._gl.UNSIGNED_BYTE,t)}}const be=`#version 300 es
precision mediump float;

in vec2 texCoord;
uniform sampler2D uImage;
out vec4 color;

void main() {
    color = texture(uImage, texCoord) + vec4(vec3(0.1), 1.0);
    // color = color * vec4(texCoord.x, texCoord.y, 0.0, 1.0);
    // color = vec4(1.0, 0.0, 0.0, 1.0);
}
`,Fe=`#version 300 es
precision mediump float;

layout (location = 0) in vec3 pos;
layout (location = 1) in vec3 norm;
layout (location = 2) in vec2 tex;

uniform mat4 model;
uniform mat4 projection;
uniform mat4 view;

out vec2 texCoord;

void main () {
    gl_Position = projection * view * model * vec4(pos, 1.0);
    texCoord = tex;
}
`,$=document.documentElement.clientWidth*.9,Q=document.documentElement.clientHeight*.9,A=new le($,Q),X=new ne(A.gl,Fe,be),p=document.createElement("video");p.src="/sphere.mp4";const ee=new Me(A.gl);p.addEventListener("loadedmetadata",()=>{p.currentTime=.1,ee.initialise(p)});p.addEventListener("ended",()=>{p.currentTime=.1,p.play()});const V=document.getElementById("play");V==null||V.addEventListener("click",()=>{p.play(),V.hidden=!0});const te=new ve(A.gl,$>=500?.6:.4);te.initialise();const Ie=A.gl.getUniformLocation(X.id,"model"),Ue=A.gl.getUniformLocation(X.id,"projection"),Pe=A.gl.getUniformLocation(X.id,"view"),ie=F();fe(ie,q(45),$/Q,.1,100);let H=0,k=0,z=130,Se=-23.5;const Be=10;function re(e){A.clear(),H=(e-k)*.002,k=e,p.paused||(z>=360?z=0:z+=H*Be),X.use();const t=F();oe(t,t,q(Se)),ae(t,t,q(z));const n=F();de(n,u(0,0,2.5),u(0,0,1.5),u(0,1,0)),A.gl.uniformMatrix4fv(Ie,!1,t),A.gl.uniformMatrix4fv(Pe,!1,n),A.gl.uniformMatrix4fv(Ue,!1,ie),p.readyState===p.HAVE_ENOUGH_DATA&&(ee.update(p),te.draw()),A.gl.useProgram(null),A.gl.bindTexture(A.gl.TEXTURE_2D,null),window.requestAnimationFrame(re)}re(H);
